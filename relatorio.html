<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Relat√≥rio de Frequ√™ncia - ICMS Esportivo</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <img src="logo-prefeitura.png">
  <div>
    <h1>Di√°rio Digital do Esporte - Juruaia</h1>
    <p>Institui√ß√£o: Prefeitura Municipal de Juruaia</p>
    <p>Professor Respons√°vel: Alex Castro</p>
  </div>
</header>

<nav>
  <a href="index.html">In√≠cio</a>
  <a href="turmas.html">Turmas</a>
  <a href="cadastro.html">Alunos</a>
  <a href="aulas.html">Chamada</a>
  <a href="ocorrencias.html">Ocorr√™ncias</a>
  <a href="relatorio.html">Relat√≥rio ICMS</a>
</nav>

<main>

<h2>Relat√≥rio Oficial de Frequ√™ncia</h2>
<p>Documento para presta√ß√£o de contas do ICMS Esportivo</p>

<hr>

<div id="relatorioArea"></div>

<br><br>

<div style="display:flex; justify-content:space-around; margin-top:60px;">
  <div style="text-align:center;">
    _______________________________<br>
    <strong>Professor Respons√°vel</strong><br>
    Alex Castro
  </div>

  <div style="text-align:center;">
    _______________________________<br>
    <strong>Diretor de Esportes</strong><br>
    Ednilson Donizetti Francisco de Souza
  </div>
</div>

<br><br>

<button onclick="window.print()">üñ®Ô∏è Imprimir Relat√≥rio</button>

</main>

<script>
// ===== CARREGAR DADOS =====
let turmas = JSON.parse(localStorage.getItem("turmas")) || [];
let alunos = JSON.parse(localStorage.getItem("alunos")) || [];
let chamadas = JSON.parse(localStorage.getItem("chamadas")) || [];

const relatorio = document.getElementById("relatorioArea");

function gerarRelatorio() {
  let html = "";

  turmas.forEach(turma => {
    html += `<h3>Turma: ${turma.nome}  ‚Äî Professor: ${turma.professor}</h3>`;

    // Alunos da turma
    let alunosTurma = alunos.filter(a => a.turma === turma.nome);

    if(alunosTurma.length === 0){
      html += "<p>Nenhum aluno cadastrado nesta turma.</p>";
      return;
    }

    html += `
      <table border="1" width="100%" style="margin-bottom:20px;">
        <tr>
          <th>Aluno</th>
          <th>Presen√ßas</th>
          <th>Faltas</th>
          <th>% Frequ√™ncia</th>
        </tr>
    `;

    alunosTurma.forEach(aluno => {

      // Contar presen√ßas e faltas nas chamadas
      let registrosAluno = chamadas.filter(c => c.idAluno == aluno.id);
      let presencas = registrosAluno.filter(r => r.presente === true).length;
      let faltas = registrosAluno.filter(r => r.presente === false).length;
      let total = presencas + faltas;
      let percentual = total > 0 ? ((presencas / total) * 100).toFixed(1) : "0.0";

      html += `
        <tr>
          <td>${aluno.nome}</td>
          <td>${presencas}</td>
          <td>${faltas}</td>
          <td>${percentual}%</td>
        </tr>
      `;
    });

    html += "</table><hr>";
  });

  relatorio.innerHTML = html;
}

gerarRelatorio();
</script>

</body>
</html>
